var SITE_ID=$("#site_id").val(),MAX_PAGE=99,commonFormData={initialized:!1,error:{},token:$("#token").val(),clearError:function(){var t=this;$.each(this.error,function(e,r){$.observable(t.error).setProperty(e,"")}),$.each($("div.dropdown"),function(t,e){$(this).removeClass("error")})},setError:function(t){void 0!=t&&(this._setError(t),t.token&&$.observable(messages).setProperty("error",t.token))},_setError:function(t){var e=this;$.each(t,function(t,r){$.isArray(r)?$.observable(e.error).setProperty(t,r[0]):$.observable(e.error).setProperty(t,r)})},initialize:function(t){var e=this;$.each(t,function(t,r){$.observable(e).setProperty(t,r)}),$.observable(this).setProperty("initialized",!0)},getTs:function(){return(new Date).getTime()}},settingFormData={initialized:!1,standard_parameter:[],custom_parameter:[],token:$("#token").val(),clearError:function(){var t=this;$.each(t.standard_parameter,function(e,r){$.each(r,function(r,o){$.observable(t.standard_parameter[e].error).setProperty(r,"")})}),$.each(t.custom_parameter,function(e,r){$.each(r,function(r,o){$.observable(t.custom_parameter[e].error).setProperty(r,"")})}),$.each($("div.dropdown"),function(t,e){$(this).removeClass("error")})},setError:function(t){void 0!=t&&(t.standard_parameter&&this._setError("standard",t.standard_parameter),t.custom_parameter&&this._setError("custom",t.custom_parameter),t.token&&$.observable(messages).setProperty("error",t.token))},_setError:function(t,e){var r=this;$.each(e,function(e,o){$.each(o,function(o,a){$.observable(r[t+"_parameter"][e].error).setProperty(o,a)})})},add:function(t){$.observable(this.custom_parameter).insert(this.custom_parameter.length,this.initialData(t))},remove:function(t){$.observable(this.custom_parameter).remove(t)},initialData:function(t){return{key:"",column_name:"",note:"",error:{}}},initialize:function(t,e){t.standard_parameter&&($.each(t.standard_parameter,function(e,r){t.standard_parameter[e].error={}}),$.observable(this.standard_parameter).refresh(t.standard_parameter)),t.custom_parameter&&($.each(t.custom_parameter,function(e,r){t.custom_parameter[e].error={}}),$.observable(this.custom_parameter).refresh(t.custom_parameter),$.observable(this.custom_parameter).insert(this.custom_parameter.length,this.initialData(e))),t.options&&$.observable(this).setProperty({options:t.options}),$.observable(this).setProperty("initialized",!0)},getTs:function(){return(new Date).getTime()}},formData=commonFormData,messages={error:null,notice:null,clear:function(){$.observable(this).setProperty("error",null),$.observable(this).setProperty("notice",null),formData.clearError()},setError:function(t){var e=this;$.each(t,function(t,r){$.observable(e).setProperty("error",r)})},setNotice:function(t){$.observable(this).setProperty("notice",t)}},finder={generateListUrl:function(t){alert("MUST BE OVERRIDDEN")},search:function(t,e){var r=$.Deferred();return $.ajax({url:this.generateListUrl(),method:"GET",data_type:"json",timeout:AJAX_TIMEOUT,error:function(t,e,o){var a=JSON.parse(t.responseText);messages.setError(a.messages.message),formData.setError(a.detail),showErrorAlert(messages.error),r.reject()},success:function(e){formData.initialize(e),t&&t()},complete:function(){r.resolve()}}),r.promise()}},listData={initialized:!1,id_prefix:"",detail:[],initialize:function(t){t.total||(t.total=0),$.observable(this.detail).refresh(t.detail),this.pager.setTotal(t.total),t.all_total&&this.pager.setAllTotal(t.all_total),$.observable(this).setProperty("initialized",!0)},pager:{delegated:"",initialized:!1,all_total:0,total:0,page:1,limit:10,start_count:0,end_count:0,offset:0,prev_name:"#pager_prev",next_name:"#pager_next",reset:function(){$.observable(this).setProperty({total:0}),$.observable(this).setProperty({page:1}),$.observable(this).setProperty({offset:0}),$.observable(this).setProperty({start_count:0}),$.observable(this).setProperty({end_count:0})},top:function(){this.setPage(1,!0)},prev:function(){var t=toNumber(this.page);t>MAX_PAGE&&(t=MAX_PAGE),this.setPage(t-1<1?1:t-1)},next:function(){var t=toNumber(this.page);t>MAX_PAGE&&(t=MAX_PAGE),this.setPage(t+1<1?1:t+1)},setPage:function(t,e){e=e||!1,t>MAX_PAGE&&(t=MAX_PAGE),$.observable(this).setProperty({page:t}),this._setOffset(),finder.search(null,e)},setLimit:function(t,e,r){this.reset(),$.observable(this).setProperty({limit:t}),this.top()},setTotal:function(t){$.observable(this).setProperty({total:t}),$.observable(this).setProperty({start_count:0==this.total||Math.ceil(this.total/this.limit)<this.page?0:this.total<this.offset+1?this.offset:this.offset+1}),$.observable(this).setProperty({end_count:0==this.total||0==this.total||Math.ceil(this.total/this.limit)<this.page?0:this.total<this.limit*this.page?this.total:this.limit*this.page})},_setOffset:function(){$.observable(this).setProperty({offset:this.limit*(this.page-1)})},setUp:function(t,e,r,o,a,i){var s=this;a=a||listData,t=t||"#template_list",e=e||"#list",$.templates(t).link(e,a),r=r||"#template_pager",o=o||"#pager",$.templates(r).link(o,a),$.observable(this).setProperty("initialized",!0),i=i||e,-1===this.delegated.indexOf(i)&&($(document).on("click",i+" div.dropdown ul.dropdown-menu li.pager_limit",function(t){s.setLimit($(t.currentTarget).attr("value")),t.preventDefault()}).on("click",i+" div.dropdown ul.dropdown-menu li.export_format",function(t){executeDownload(finder.generateListUrl("-",0,$(t.currentTarget).attr("value"))),t.preventDefault()}).on("click",i+" #pager_prev",function(){return s.prev(),!1}).on("click",i+" #pager_next",function(){return s.next(),!1}).on("keypress",i+" #page",function(t){13==t.which&&$(this).trigger("blur")}).on("blur",i+" #page",function(){var t=toNumber(this.value);(t=t<1?1:t)>MAX_PAGE&&(t=MAX_PAGE),t=s.total<s.limit*t?Math.ceil(s.total/s.limit):t,this.value=t,s.setPage(t)}),this.delegated+="|"+i)},setAllTotal:function(t){$.observable(this).setProperty({all_total:t})}}},ActionExportPopover={content:function(t){return $("#template_popover_export").render({id:this.id})},initialize:function(){}};$("body").popover&&$("body").popover({title:"エクスポートメニュー",placement:"bottom",container:"body",html:!0,sanitize:!1,trigger:"focus",content:ActionExportPopover.content,selector:".action_export",delay:{show:0,hide:500}}),$(document).on("click",".action_export",function(t){t.preventDefault()});